@startuml
autonumber "<b>0'.'"
box "Controltower" #LightBlue
Participant "Controltower\nEDC" as Controltower
Participant "Controltower\nDID Document" as DID1
Participant "Controltower\nIdentity Hub" as IDHUB1
end box
box "Dataspace Authority" #LightYellow
Participant "Dataspace\nDID Document" as DID0
Participant "Registration Service" as RAPI
Database "Participants\nStore" as Registry
end box
box "Bridge (, 3, etc.)" #LightCyan
Participant "Bridge\nDID Document" as DID2
Participant "Bridge\nEDC" as Bridge
end box

Controltower -> DID0: Get registry endpoint
Controltower -> RAPI ++: List participants:\n - DID JWS\n - Hub Token
activate Controltower
group authorize request [Distributed authorization sub-flow]
  RAPI -> DID1
  RAPI -> IDHUB1
end
RAPI -> RAPI: apply access policy
RAPI -> Registry: query participants
return participants (list of DID URIs)
Controltower -> DID2: Get DID Document (contains URL of Bridge EDC Catalog Endpoint)
deactivate Controltower

@enduml